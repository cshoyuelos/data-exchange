<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>dataexchange.xtomo.formats.EdfFile &mdash; Data Exchange 0.2 documentation</title>
    
    <link rel="stylesheet" href="../../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '0.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="author" title="About these documents" href="../../../../about.html" />
    <link rel="top" title="Data Exchange 0.2 documentation" href="../../../../index.html" />
    <link rel="up" title="Module code" href="../../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../../index.html">Data Exchange 0.2 documentation</a> &raquo;</li>
          <li><a href="../../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for dataexchange.xtomo.formats.EdfFile</h1><div class="highlight"><pre>
<span class="c">#/*##########################################################################</span>
<span class="c"># Copyright (C) 2004-2010 European Synchrotron Radiation Facility</span>
<span class="c">#</span>
<span class="c"># This file is part of the PyMCA X-ray Fluorescence Toolkit developed at</span>
<span class="c"># the ESRF by the Beamline Instrumentation Software Support (BLISS) group.</span>
<span class="c">#</span>
<span class="c"># This toolkit is free software; you can redistribute it and/or modify it </span>
<span class="c"># under the terms of the GNU General Public License as published by the Free</span>
<span class="c"># Software Foundation; either version 2 of the License, or (at your option) </span>
<span class="c"># any later version.</span>
<span class="c">#</span>
<span class="c"># PyMCA is distributed in the hope that it will be useful, but WITHOUT ANY</span>
<span class="c"># WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS</span>
<span class="c"># FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more</span>
<span class="c"># details.</span>
<span class="c">#</span>
<span class="c"># You should have received a copy of the GNU General Public License along with</span>
<span class="c"># PyMCA; if not, write to the Free Software Foundation, Inc., 59 Temple Place,</span>
<span class="c"># Suite 330, Boston, MA 02111-1307, USA.</span>
<span class="c">#</span>
<span class="c"># PyMCA follows the dual licensing model of Trolltech&#39;s Qt and Riverbank&#39;s PyQt</span>
<span class="c"># and cannot be used as a free plugin for a non-free program. </span>
<span class="c">#</span>
<span class="c"># Please contact the ESRF industrial unit (industry@esrf.fr) if this license </span>
<span class="c"># is a problem for you.</span>
<span class="c">#############################################################################*/</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    EdfFile.py</span>
<span class="sd">    Generic class for Edf files manipulation.    </span>

<span class="sd">    Interface:</span>
<span class="sd">    ===========================</span>
<span class="sd">    class EdfFile:          </span>
<span class="sd">        __init__(self,FileName)	</span>
<span class="sd">        GetNumImages(self)</span>
<span class="sd">        def GetData(self,Index, DataType=&quot;&quot;,Pos=None,Size=None):</span>
<span class="sd">        GetPixel(self,Index,Position)</span>
<span class="sd">        GetHeader(self,Index)</span>
<span class="sd">        GetStaticHeader(self,Index)</span>
<span class="sd">        WriteImage (self,Header,Data,Append=1,DataType=&quot;&quot;,WriteAsUnsigened=0,ByteOrder=&quot;&quot;)</span>


<span class="sd">    Edf format assumptions:</span>
<span class="sd">    ===========================</span>
<span class="sd">    The following details were assumed for this implementation:</span>
<span class="sd">    - Each Edf file contains a certain number of data blocks.</span>
<span class="sd">    - Each data block represents data stored in an one, two or three-dimensional array.</span>
<span class="sd">    - Each data block contains a header section, written in ASCII, and a data section of</span>
<span class="sd">      binary information.</span>
<span class="sd">    - The size of the header section in bytes is a multiple of 1024. The header is</span>
<span class="sd">      padded with spaces (0x20). If the header is not padded to a multiple of 1024,</span>
<span class="sd">      the file is recognized, but the output is always made in this format.</span>
<span class="sd">    - The header section starts by &#39;{&#39; and finishes by &#39;}&#39;. It is composed by several</span>
<span class="sd">      pairs &#39;keyword = value;&#39;. The keywords are case insensitive, but the values are case</span>
<span class="sd">      sensitive. Each pair is put in a new line (they are separeted by 0x0A). In the</span>
<span class="sd">      end of each line, a semicolon (;) separes the pair of a comment, not interpreted.</span>
<span class="sd">      Exemple:</span>
<span class="sd">        {</span>
<span class="sd">        ; Exemple Header</span>
<span class="sd">        HeaderID = EH:000001:000000:000000    ; automatically generated</span>
<span class="sd">        ByteOrder = LowByteFirst              ; </span>
<span class="sd">        DataType = FloatValue                 ; 4 bytes per pixel</span>
<span class="sd">        Size = 4000000                        ; size of data section</span>
<span class="sd">        Dim_1= 1000                           ; x coordinates</span>
<span class="sd">        Dim_2 = 1000                          ; y coordinates</span>
<span class="sd">        </span>
<span class="sd">        (padded with spaces to complete 1024 bytes)</span>
<span class="sd">        }</span>
<span class="sd">    - There are some fields in the header that are required for this implementation. If any of</span>
<span class="sd">      these is missing, or inconsistent, it will be generated an error:</span>
<span class="sd">        Size: Represents size of data block</span>
<span class="sd">        Dim_1: size of x coordinates (Dim_2 for 2-dimentional images, and also Dim_3 for 3d)</span>
<span class="sd">        DataType</span>
<span class="sd">        ByteOrder</span>
<span class="sd">    - For the written images, these fields are automatically genereted:</span>
<span class="sd">        Size,Dim_1 (Dim_2 and Dim_3, if necessary), Byte Order, DataType, HeaderID and Image</span>
<span class="sd">      These fields are called here &quot;static header&quot;, and can be retrieved by the method</span>
<span class="sd">      GetStaticHeader. Other header components are taken by GetHeader. Both methods returns</span>
<span class="sd">      a dictionary in which the key is the keyword of the pair. When writting an image through</span>
<span class="sd">      WriteImage method, the Header parameter should not contain the static header information,</span>
<span class="sd">      which is automatically generated.</span>
<span class="sd">    - The indexing of images through these functions is based just on the 0-based position in</span>
<span class="sd">      the file, the header items HeaderID and Image are not considered for referencing the</span>
<span class="sd">      images.</span>
<span class="sd">    - The data section contais a number of bytes equal to the value of Size keyword. Data</span>
<span class="sd">      section is going to be translated into an 1D, 2D or 3D Numpy Array, and accessed</span>
<span class="sd">      through GetData method call.      </span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">__author__</span> <span class="o">=</span> <span class="s">&#39;Alexandre Gobbo (gobbo@esrf.fr)&#39;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s">&#39;$Revision: 1.6 $&#39;</span>
<span class="n">DEBUG</span> <span class="o">=</span> <span class="mi">0</span>
<span class="c">################################################################################  </span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">MarCCD</span>
    <span class="n">MARCCD_SUPPORT</span> <span class="o">=</span> <span class="bp">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="c">#MarCCD</span>
    <span class="n">MARCCD_SUPPORT</span> <span class="o">=</span> <span class="bp">False</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">PilatusCBF</span>
    <span class="n">PILATUS_CBF_SUPPORT</span> <span class="o">=</span> <span class="bp">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">PILATUS_CBF_SUPPORT</span> <span class="o">=</span> <span class="bp">False</span>
<span class="kn">import</span> <span class="nn">os.path</span> <span class="c">#, tempfile, shutil</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">FastEdf</span> <span class="kn">import</span> <span class="n">extended_fread</span>
    <span class="n">CAN_USE_FASTEDF</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">CAN_USE_FASTEDF</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c">################################################################################</span>
<span class="c"># constants</span>
<span class="n">HEADER_BLOCK_SIZE</span> <span class="o">=</span> <span class="mi">1024</span>
<span class="n">STATIC_HEADER_ELEMENTS</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;HeaderID&quot;</span><span class="p">,</span> <span class="s">&quot;Image&quot;</span><span class="p">,</span> <span class="s">&quot;ByteOrder&quot;</span><span class="p">,</span> <span class="s">&quot;DataType&quot;</span><span class="p">,</span>
                        <span class="s">&quot;Dim_1&quot;</span><span class="p">,</span> <span class="s">&quot;Dim_2&quot;</span><span class="p">,</span> <span class="s">&quot;Dim_3&quot;</span><span class="p">,</span>
                        <span class="s">&quot;Offset_1&quot;</span><span class="p">,</span> <span class="s">&quot;Offset_2&quot;</span><span class="p">,</span> <span class="s">&quot;Offset_3&quot;</span><span class="p">,</span>
                        <span class="s">&quot;Size&quot;</span><span class="p">)</span>
<span class="n">STATIC_HEADER_ELEMENTS_CAPS</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;HEADERID&quot;</span><span class="p">,</span> <span class="s">&quot;IMAGE&quot;</span><span class="p">,</span> <span class="s">&quot;BYTEORDER&quot;</span><span class="p">,</span> <span class="s">&quot;DATATYPE&quot;</span><span class="p">,</span>
                             <span class="s">&quot;DIM_1&quot;</span><span class="p">,</span> <span class="s">&quot;DIM_2&quot;</span><span class="p">,</span> <span class="s">&quot;DIM_3&quot;</span><span class="p">,</span>
                             <span class="s">&quot;OFFSET_1&quot;</span><span class="p">,</span> <span class="s">&quot;OFFSET_2&quot;</span><span class="p">,</span> <span class="s">&quot;OFFSET_3&quot;</span><span class="p">,</span>
                             <span class="s">&quot;SIZE&quot;</span><span class="p">)</span>

<span class="n">LOWER_CASE</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">UPPER_CASE</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">KEYS</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">VALUES</span> <span class="o">=</span> <span class="mi">2</span>

<span class="c">###############################################################################</span>
<div class="viewcode-block" id="Image"><a class="viewcode-back" href="../../../../resources/dataexchange.xtomo.formats.EdfFile.html#dataexchange.xtomo.formats.EdfFile.Image">[docs]</a><span class="k">class</span> <span class="nc">Image</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Constructor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Header</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">StaticHeader</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">HeaderPosition</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DataPosition</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NumDim</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Dim1</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Dim2</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Dim3</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DataType</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="c">#for i in STATIC_HEADER_ELEMENTS: self.StaticHeader[i]=&quot;&quot;</span>

<span class="c">################################################################################</span>
</div>
<div class="viewcode-block" id="EdfFile"><a class="viewcode-back" href="../../../../resources/dataexchange.xtomo.formats.EdfFile.html#dataexchange.xtomo.formats.EdfFile.EdfFile">[docs]</a><span class="k">class</span>  <span class="nc">EdfFile</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c">############################################################################</span>
    <span class="c">#Interface</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">FileName</span><span class="p">,</span> <span class="n">access</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">fastedf</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Constructor</span>
<span class="sd">        </span>
<span class="sd">        @param  FileName:   Name of the file (either existing or to be created)</span>
<span class="sd">        @type FileName: string</span>
<span class="sd">        @param access: access mode &quot;r&quot; for reading (the file should exist) or </span>
<span class="sd">                                   &quot;w&quot; for writing (if the file does not exist, it does not matter).</span>
<span class="sd">        @type access: string</span>
<span class="sd">        @type fastedf= True to use the fastedf module</span>
<span class="sd">        @param fastedf= boolean</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Images</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NumImages</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FileName</span> <span class="o">=</span> <span class="n">FileName</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">File</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">fastedf</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span><span class="n">fastedf</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fastedf</span> <span class="o">=</span> <span class="n">fastedf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ADSC</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MARCCD</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PILATUS_CBF</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">byteorder</span> <span class="o">==</span> <span class="s">&quot;big&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">SysByteOrder</span> <span class="o">=</span> <span class="s">&quot;HighByteFirst&quot;</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">SysByteOrder</span> <span class="o">=</span> <span class="s">&quot;LowByteFirst&quot;</span>
        <span class="k">if</span> <span class="n">access</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">access</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;R&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FileName</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s">&quot;File </span><span class="si">%s</span><span class="s"> not found&quot;</span> <span class="o">%</span> <span class="n">FileName</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FileName</span><span class="p">):</span>
                <span class="c">#write access</span>
                <span class="k">if</span> <span class="n">access</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">access</span> <span class="o">=</span> <span class="s">&quot;wb&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">File</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FileName</span><span class="p">,</span> <span class="n">access</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">access</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FileName</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">W_OK</span><span class="p">)):</span>
                        <span class="n">access</span> <span class="o">=</span> <span class="s">&quot;r+b&quot;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">access</span> <span class="o">=</span> <span class="s">&quot;rb&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">File</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FileName</span><span class="p">,</span> <span class="n">access</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">twoChars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">twoChars</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;II&quot;</span><span class="p">,</span> <span class="s">&quot;MM&quot;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">MARCCD_SUPPORT</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s">&quot;MarCCD support not implemented&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">MARCCD</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">FileName</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;.CBF&#39;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">PILATUS_CBF_SUPPORT</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s">&quot;CBF support not implemented&quot;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">twoChars</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&quot;{&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">PILATUS_CBF</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">,</span> <span class="s">&quot;EdfFile: Error opening file&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">MARCCD</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_wrapMarCCD</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">PILATUS_CBF</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_wrapPilatusCBF</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="n">Index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>

        <span class="k">while</span> <span class="n">line</span> <span class="o">!=</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">string</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&quot;{</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">string</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&quot;{</span><span class="se">\r\n</span><span class="s">&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">Index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NumImages</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">NumImages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NumImages</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Image</span><span class="p">())</span>
<span class="c">#            Position = self.File.tell()</span>

            <span class="k">if</span> <span class="n">string</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&quot;=&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">listItems</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&quot;=&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">typeItem</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">listItems</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">listItems</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">listItems</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">&quot;;&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">valueItem</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">listItems</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">typeItem</span> <span class="o">==</span> <span class="s">&quot;HEADER_BYTES&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">Index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ADSC</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="k">break</span>

                <span class="c">#if typeItem in self.Images[Index].StaticHeader.keys():          </span>
                <span class="k">if</span> <span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">upper</span><span class="p">(</span><span class="n">typeItem</span><span class="p">))</span> <span class="ow">in</span> <span class="n">STATIC_HEADER_ELEMENTS_CAPS</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">StaticHeader</span><span class="p">[</span><span class="n">typeItem</span><span class="p">]</span> <span class="o">=</span> <span class="n">valueItem</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="n">typeItem</span><span class="p">]</span> <span class="o">=</span> <span class="n">valueItem</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&quot;}</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">string</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&quot;}</span><span class="se">\r</span><span class="s">&quot;</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c">#for i in STATIC_HEADER_ELEMENTS_CAPS:</span>
                <span class="c">#    if self.Images[Index].StaticHeader[i]==&quot;&quot;:</span>
                <span class="c">#        raise &quot;Bad File Format&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">DataPosition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
                <span class="c">#self.File.seek(string.atoi(self.Images[Index].StaticHeader[&quot;Size&quot;]), 1)</span>
                <span class="n">StaticPar</span> <span class="o">=</span> <span class="n">SetDictCase</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">StaticHeader</span><span class="p">,</span> <span class="n">UPPER_CASE</span><span class="p">,</span> <span class="n">KEYS</span><span class="p">)</span>
                <span class="k">if</span> <span class="s">&quot;SIZE&quot;</span> <span class="ow">in</span> <span class="n">StaticPar</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Size</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">atoi</span><span class="p">(</span><span class="n">StaticPar</span><span class="p">[</span><span class="s">&quot;SIZE&quot;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Size</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">NumImages</span> <span class="o">=</span> <span class="n">Index</span>
                        <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                        <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="s">&quot;EdfFile: Image doesn&#39;t have size information&quot;</span>
                <span class="k">if</span> <span class="s">&quot;DIM_1&quot;</span> <span class="ow">in</span> <span class="n">StaticPar</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim1</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">atoi</span><span class="p">(</span><span class="n">StaticPar</span><span class="p">[</span><span class="s">&quot;DIM_1&quot;</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Offset1</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">atoi</span><span class="p">(</span>\
                                            <span class="n">StaticPar</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;Offset_1&quot;</span><span class="p">,</span> <span class="s">&quot;0&quot;</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="s">&quot;EdfFile: Image doesn&#39;t have dimension information&quot;</span>
                <span class="k">if</span> <span class="s">&quot;DIM_2&quot;</span> <span class="ow">in</span> <span class="n">StaticPar</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">NumDim</span> <span class="o">=</span> <span class="mi">2</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim2</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">atoi</span><span class="p">(</span><span class="n">StaticPar</span><span class="p">[</span><span class="s">&quot;DIM_2&quot;</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Offset2</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">atoi</span><span class="p">(</span>\
                                            <span class="n">StaticPar</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;Offset_2&quot;</span><span class="p">,</span> <span class="s">&quot;0&quot;</span><span class="p">))</span>
                <span class="k">if</span> <span class="s">&quot;DIM_3&quot;</span> <span class="ow">in</span> <span class="n">StaticPar</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">NumDim</span> <span class="o">=</span> <span class="mi">3</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim3</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">atoi</span><span class="p">(</span><span class="n">StaticPar</span><span class="p">[</span><span class="s">&quot;DIM_3&quot;</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Offset3</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">atoi</span><span class="p">(</span>\
                                            <span class="n">StaticPar</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;Offset_3&quot;</span><span class="p">,</span> <span class="s">&quot;0&quot;</span><span class="p">))</span>
                <span class="k">if</span> <span class="s">&quot;DATATYPE&quot;</span> <span class="ow">in</span> <span class="n">StaticPar</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">DataType</span> <span class="o">=</span> <span class="n">StaticPar</span><span class="p">[</span><span class="s">&quot;DATATYPE&quot;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="s">&quot;EdfFile: Image doesn&#39;t have datatype information&quot;</span>
                <span class="k">if</span> <span class="s">&quot;BYTEORDER&quot;</span> <span class="ow">in</span> <span class="n">StaticPar</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">ByteOrder</span> <span class="o">=</span> <span class="n">StaticPar</span><span class="p">[</span><span class="s">&quot;BYTEORDER&quot;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="s">&quot;EdfFile: Image doesn&#39;t have byteorder information&quot;</span>



                <span class="bp">self</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Size</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ADSC</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NumImages</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="c">#this is a bad implementation of fabio adscimage</span>
            <span class="c">#please take a look at the fabio module of fable at sourceforge</span>
            <span class="n">infile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">File</span>
            <span class="n">header_keys</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">header</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="sd">&quot;&quot;&quot; read an adsc header &quot;&quot;&quot;</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">infile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                <span class="n">bytesread</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                <span class="k">while</span> <span class="s">&#39;}&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s">&#39;=&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                        <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)</span>
                        <span class="n">header_keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                        <span class="n">header</span><span class="p">[</span><span class="n">key</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39; ;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">infile</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                    <span class="n">bytesread</span> <span class="o">=</span> <span class="n">bytesread</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&quot;Error processing adsc header&quot;</span><span class="p">)</span>
            <span class="c"># banned by bzip/gzip???</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">infile</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;HEADER_BYTES&#39;</span><span class="p">]),</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="c"># Gzipped does not allow a seek and read header is not</span>
                <span class="c"># promising to stop in the right place</span>
                <span class="n">infile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="n">infile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span>
                <span class="n">infile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;HEADER_BYTES&#39;</span><span class="p">]))</span>
            <span class="n">binary</span> <span class="o">=</span> <span class="n">infile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">infile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="c">#now read the data into the array</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;SIZE1&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="s">&#39;SIZE2&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">NumDim</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">DataType</span> <span class="o">=</span> <span class="s">&#39;UnsignedShort&#39;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
                    <span class="n">numpy</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint16</span><span class="p">),</span>
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim1</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">IOError</span><span class="p">,</span> <span class="s">&#39;Size spec in ADSC-header does not match &#39;</span> <span class="o">+</span> \
                    <span class="s">&#39;size of image data field&#39;</span>
            <span class="k">if</span> <span class="s">&#39;little&#39;</span> <span class="ow">in</span> <span class="n">header</span><span class="p">[</span><span class="s">&#39;BYTE_ORDER&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">ByteOrder</span> <span class="o">=</span> <span class="s">&#39;LowByteFirst&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">ByteOrder</span> <span class="o">=</span> <span class="s">&#39;HighByteFirst&#39;</span>
            <span class="k">if</span> <span class="n">string</span><span class="o">.</span><span class="n">upper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SysByteOrder</span><span class="p">)</span> <span class="o">!=</span> <span class="n">string</span><span class="o">.</span><span class="n">upper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">ByteOrder</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">byteswap</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">ByteOrder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SysByteOrder</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">StaticHeader</span><span class="p">[</span><span class="s">&#39;Dim_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">StaticHeader</span><span class="p">[</span><span class="s">&#39;Dim_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">StaticHeader</span><span class="p">[</span><span class="s">&#39;Offset_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">StaticHeader</span><span class="p">[</span><span class="s">&#39;Offset_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">StaticHeader</span><span class="p">[</span><span class="s">&#39;DataType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">DataType</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__makeSureFileIsClosed</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_wrapMarCCD</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">mccd</span> <span class="o">=</span> <span class="n">MarCCD</span><span class="o">.</span><span class="n">MarCCD</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">File</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NumImages</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__data</span> <span class="o">=</span> <span class="n">mccd</span><span class="o">.</span><span class="n">getData</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__info</span> <span class="o">=</span> <span class="n">mccd</span><span class="o">.</span><span class="n">getInfo</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Image</span><span class="p">())</span>
        <span class="n">Index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">NumDim</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">DataType</span> <span class="o">=</span> <span class="s">&#39;UnsignedByte&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint16</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">DataType</span> <span class="o">=</span> <span class="s">&#39;UnsignedShort&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">DataType</span> <span class="o">=</span> <span class="s">&#39;UnsignedInteger&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">StaticHeader</span><span class="p">[</span><span class="s">&#39;Dim_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">StaticHeader</span><span class="p">[</span><span class="s">&#39;Dim_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">StaticHeader</span><span class="p">[</span><span class="s">&#39;Offset_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">StaticHeader</span><span class="p">[</span><span class="s">&#39;Offset_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">StaticHeader</span><span class="p">[</span><span class="s">&#39;DataType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">DataType</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Header</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__info</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_wrapPilatusCBF</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">mccd</span> <span class="o">=</span> <span class="n">PilatusCBF</span><span class="o">.</span><span class="n">PilatusCBF</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">File</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NumImages</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__data</span> <span class="o">=</span> <span class="n">mccd</span><span class="o">.</span><span class="n">getData</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__info</span> <span class="o">=</span> <span class="n">mccd</span><span class="o">.</span><span class="n">getInfo</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Image</span><span class="p">())</span>
        <span class="n">Index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">NumDim</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">DataType</span> <span class="o">=</span> <span class="s">&#39;UnsignedByte&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint16</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">DataType</span> <span class="o">=</span> <span class="s">&#39;UnsignedShort&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">DataType</span> <span class="o">=</span> <span class="s">&#39;UnsignedInteger&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">StaticHeader</span><span class="p">[</span><span class="s">&#39;Dim_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">StaticHeader</span><span class="p">[</span><span class="s">&#39;Dim_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">StaticHeader</span><span class="p">[</span><span class="s">&#39;Offset_1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">StaticHeader</span><span class="p">[</span><span class="s">&#39;Offset_2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">StaticHeader</span><span class="p">[</span><span class="s">&#39;DataType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">DataType</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Header</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__info</span><span class="p">)</span>

<div class="viewcode-block" id="EdfFile.GetNumImages"><a class="viewcode-back" href="../../../../resources/dataexchange.xtomo.formats.EdfFile.html#dataexchange.xtomo.formats.EdfFile.EdfFile.GetNumImages">[docs]</a>    <span class="k">def</span> <span class="nf">GetNumImages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns number of images of the object (and associated file)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">NumImages</span>
</div>
<div class="viewcode-block" id="EdfFile.GetData"><a class="viewcode-back" href="../../../../resources/dataexchange.xtomo.formats.EdfFile.html#dataexchange.xtomo.formats.EdfFile.EdfFile.GetData">[docs]</a>    <span class="k">def</span> <span class="nf">GetData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">var</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__makeSureFileIsOpen</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_GetData</span><span class="p">(</span><span class="o">*</span><span class="n">var</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__makeSureFileIsClosed</span><span class="p">()</span>
            </div>
    <span class="k">def</span> <span class="nf">_GetData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Index</span><span class="p">,</span> <span class="n">DataType</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">Pos</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">Size</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns numpy array with image data</span>
<span class="sd">            Index:          The zero-based index of the image in the file</span>
<span class="sd">            DataType:       The edf type of the array to be returnd</span>
<span class="sd">                            If ommited, it is used the default one for the type</span>
<span class="sd">                            indicated in the image header</span>
<span class="sd">                            Attention to the absence of UnsignedShort,</span>
<span class="sd">                            UnsignedInteger and UnsignedLong types in</span>
<span class="sd">                            Numpy Python</span>
<span class="sd">                            Default relation between Edf types and NumPy&#39;s typecodes:</span>
<span class="sd">                                SignedByte          int8   b</span>
<span class="sd">                                UnsignedByte        uint8  B       </span>
<span class="sd">                                SignedShort         int16  h</span>
<span class="sd">                                UnsignedShort       uint16 H</span>
<span class="sd">                                SignedInteger       int32  i</span>
<span class="sd">                                UnsignedInteger     uint32 I</span>
<span class="sd">                                SignedLong          int32  i</span>
<span class="sd">                                UnsignedLong        uint32 I</span>
<span class="sd">                                Signed64            int64  (l in 64bit, q in 32 bit)</span>
<span class="sd">                                Unsigned64          uint64 (L in 64bit, Q in 32 bit) </span>
<span class="sd">                                FloatValue          float32 f</span>
<span class="sd">                                DoubleValue         float64 d</span>
<span class="sd">            Pos:            Tuple (x) or (x,y) or (x,y,z) that indicates the begining</span>
<span class="sd">                            of data to be read. If ommited, set to the origin (0),</span>
<span class="sd">                            (0,0) or (0,0,0)</span>
<span class="sd">            Size:           Tuple, size of the data to be returned as x) or (x,y) or</span>
<span class="sd">                            (x,y,z) if ommited, is the distance from Pos to the end.</span>

<span class="sd">            If Pos and Size not mentioned, returns the whole data.                         </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fastedf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fastedf</span>
        <span class="k">if</span> <span class="n">Index</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">Index</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NumImages</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="s">&quot;EdfFile: Index out of limit&quot;</span>
        <span class="k">if</span> <span class="n">fastedf</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span><span class="n">fastedf</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">Pos</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">Size</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ADSC</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">MARCCD</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">PILATUS_CBF</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">DataPosition</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">datatype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__GetDefaultNumpyType__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">DataType</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">Index</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">datasize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__GetSizeNumpyType__</span><span class="p">(</span><span class="n">datatype</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s">&quot;What is the meaning of this error?&quot;</span>
                    <span class="n">datasize</span> <span class="o">=</span> <span class="mi">8</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">NumDim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">sizeToRead</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim1</span> <span class="o">*</span> \
                                 <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim2</span> <span class="o">*</span> \
                                 <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim3</span> <span class="o">*</span> <span class="n">datasize</span>
                    <span class="n">Data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">sizeToRead</span><span class="p">),</span>
                                <span class="n">datatype</span><span class="p">)</span>
                    <span class="n">Data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Data</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim1</span><span class="p">))</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">NumDim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">sizeToRead</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim1</span> <span class="o">*</span> \
                                 <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim2</span> <span class="o">*</span> <span class="n">datasize</span>
                    <span class="n">Data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">sizeToRead</span><span class="p">),</span>
                                <span class="n">datatype</span><span class="p">)</span>
                    <span class="c">#print &quot;datatype = &quot;,datatype</span>
                    <span class="c">#print &quot;Data.type = &quot;, Data.dtype.char</span>
                    <span class="c">#print &quot;self.Images[Index].DataType &quot;, self.Images[Index].DataType</span>
                    <span class="c">#print &quot;Data.shape&quot;,Data.shape</span>
                    <span class="c">#print &quot;datasize = &quot;,datasize</span>
                    <span class="c">#print &quot;sizeToRead &quot;,sizeToRead </span>
                    <span class="c">#print &quot;lenData = &quot;, len(Data)</span>
                    <span class="n">Data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Data</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim1</span><span class="p">))</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">NumDim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">sizeToRead</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim1</span> <span class="o">*</span> <span class="n">datasize</span>
                    <span class="n">Data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">sizeToRead</span><span class="p">),</span>
                                <span class="n">datatype</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ADSC</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">MARCCD</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">PILATUS_CBF</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__data</span><span class="p">[</span><span class="n">Pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]:(</span><span class="n">Pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">Size</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                               <span class="n">Pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]:(</span><span class="n">Pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">Size</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
        <span class="k">elif</span> <span class="n">fastedf</span> <span class="ow">and</span> <span class="n">CAN_USE_FASTEDF</span><span class="p">:</span>
            <span class="nb">type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__GetDefaultNumpyType__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">DataType</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">Index</span><span class="p">)</span>
            <span class="n">size_pixel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__GetSizeNumpyType__</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span>
            <span class="n">Data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="nb">type</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">NumDim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">Pos</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">Pos</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,)</span>
                <span class="k">if</span> <span class="n">Size</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">Size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,)</span>
                <span class="n">sizex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim1</span>
                <span class="n">Size</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Size</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">Size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span><span class="n">Size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sizex</span> <span class="o">-</span> <span class="n">Pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">seek</span><span class="p">((</span><span class="n">Pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">size_pixel</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">DataPosition</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">Data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">Size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">size_pixel</span><span class="p">),</span> <span class="nb">type</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">NumDim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">Pos</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">Pos</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">Size</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">Size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">Size</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Size</span><span class="p">)</span>
                <span class="n">sizex</span><span class="p">,</span> <span class="n">sizey</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim2</span>
                <span class="k">if</span> <span class="n">Size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span><span class="n">Size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sizex</span> <span class="o">-</span> <span class="n">Pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">Size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span><span class="n">Size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">sizey</span> <span class="o">-</span> <span class="n">Pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">Data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">Size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Size</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="nb">type</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">seek</span><span class="p">((((</span><span class="n">Pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">sizex</span><span class="p">)</span> <span class="o">+</span> <span class="n">Pos</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">size_pixel</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">DataPosition</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">extended_fread</span><span class="p">(</span><span class="n">Data</span><span class="p">,</span> <span class="n">Size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">size_pixel</span> <span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">Size</span><span class="p">[</span><span class="mi">1</span><span class="p">]]),</span>
                               <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">sizex</span> <span class="o">*</span> <span class="n">size_pixel</span><span class="p">])</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">File</span><span class="p">)</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">NumDim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">Pos</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">Pos</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">Size</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">Size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">Size</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Size</span><span class="p">)</span>
                <span class="n">sizex</span><span class="p">,</span> <span class="n">sizey</span><span class="p">,</span> <span class="n">sizez</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim3</span>
                <span class="k">if</span> <span class="n">Size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span><span class="n">Size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sizex</span> <span class="o">-</span> <span class="n">Pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">Size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span><span class="n">Size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">sizey</span> <span class="o">-</span> <span class="n">Pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">Size</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span><span class="n">Size</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">sizez</span> <span class="o">-</span> <span class="n">Pos</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">Data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">Size</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">Size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Size</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="nb">type</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">seek</span><span class="p">(((((</span><span class="n">Pos</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">sizey</span> <span class="o">+</span> <span class="n">Pos</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">sizex</span><span class="p">)</span> <span class="o">+</span> <span class="n">Pos</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">size_pixel</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">DataPosition</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">extended_fread</span><span class="p">(</span><span class="n">Data</span><span class="p">,</span> <span class="n">Size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">size_pixel</span> <span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">Size</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">Size</span><span class="p">[</span><span class="mi">1</span><span class="p">]]),</span>
                        <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">sizey</span> <span class="o">*</span> <span class="n">sizex</span> <span class="o">*</span> <span class="n">size_pixel</span> <span class="p">,</span> <span class="n">sizex</span> <span class="o">*</span> <span class="n">size_pixel</span><span class="p">])</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">File</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">fastedf</span><span class="p">:</span><span class="k">print</span> <span class="s">&quot;I could not use fast routines&quot;</span>
            <span class="nb">type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__GetDefaultNumpyType__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">DataType</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">Index</span><span class="p">)</span>
            <span class="n">size_pixel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__GetSizeNumpyType__</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span>
            <span class="n">Data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="nb">type</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">NumDim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">Pos</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">Pos</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,)</span>
                <span class="k">if</span> <span class="n">Size</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">Size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,)</span>
                <span class="n">sizex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim1</span>
                <span class="n">Size</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Size</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">Size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span><span class="n">Size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sizex</span> <span class="o">-</span> <span class="n">Pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">seek</span><span class="p">((</span><span class="n">Pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">size_pixel</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">DataPosition</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">Data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">Size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">size_pixel</span><span class="p">),</span> <span class="nb">type</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">NumDim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">Pos</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">Pos</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">Size</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">Size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">Size</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Size</span><span class="p">)</span>
                <span class="n">sizex</span><span class="p">,</span> <span class="n">sizey</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim2</span>
                <span class="k">if</span> <span class="n">Size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span><span class="n">Size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sizex</span> <span class="o">-</span> <span class="n">Pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">Size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span><span class="n">Size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">sizey</span> <span class="o">-</span> <span class="n">Pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="c">#print len(range(Pos[1],Pos[1]+Size[1])), &quot;LECTURES OF &quot;, Size[0], &quot;POINTS&quot;</span>
                <span class="c">#print &quot;sizex = &quot;, sizex, &quot;sizey = &quot;, sizey</span>
                <span class="n">Data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Size</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">type</span><span class="p">)</span>
                <span class="n">dataindex</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Pos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">Size</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">seek</span><span class="p">((((</span><span class="n">y</span> <span class="o">*</span> <span class="n">sizex</span><span class="p">)</span> <span class="o">+</span> <span class="n">Pos</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">size_pixel</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">DataPosition</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">Size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">size_pixel</span><span class="p">),</span> <span class="nb">type</span><span class="p">)</span>
                    <span class="n">Data</span><span class="p">[</span><span class="n">dataindex</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:]</span>
                    <span class="c">#Data=numpy.concatenate((Data,line))</span>
                    <span class="n">dataindex</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="c">#print &quot;DataSize = &quot;,Data.shape</span>
                <span class="c">#print &quot;Requested reshape = &quot;,Size[1],&#39;x&#39;,Size[0]</span>
                <span class="c">#Data = numpy.reshape(Data, (Size[1],Size[0]))                            </span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">NumDim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">Pos</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">Pos</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">Size</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">Size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">Size</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Size</span><span class="p">)</span>
                <span class="n">sizex</span><span class="p">,</span> <span class="n">sizey</span><span class="p">,</span> <span class="n">sizez</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim3</span>
                <span class="k">if</span> <span class="n">Size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span><span class="n">Size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sizex</span> <span class="o">-</span> <span class="n">Pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">Size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span><span class="n">Size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">sizey</span> <span class="o">-</span> <span class="n">Pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">Size</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span><span class="n">Size</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">sizez</span> <span class="o">-</span> <span class="n">Pos</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Pos</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">Pos</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">Size</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
                    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Pos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">Size</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">seek</span><span class="p">(((((</span><span class="n">z</span> <span class="o">*</span> <span class="n">sizey</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="n">sizex</span><span class="p">)</span> <span class="o">+</span> <span class="n">Pos</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">size_pixel</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">DataPosition</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                        <span class="n">line</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">Size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">size_pixel</span><span class="p">),</span> <span class="nb">type</span><span class="p">)</span>
                        <span class="n">Data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">Data</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span>
                <span class="n">Data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Data</span><span class="p">,</span> <span class="p">(</span><span class="n">Size</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">Size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Size</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

        <span class="k">if</span> <span class="n">string</span><span class="o">.</span><span class="n">upper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SysByteOrder</span><span class="p">)</span> <span class="o">!=</span> <span class="n">string</span><span class="o">.</span><span class="n">upper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">ByteOrder</span><span class="p">):</span>
            <span class="n">Data</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="n">byteswap</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">DataType</span> <span class="o">!=</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
            <span class="n">Data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__SetDataType__</span> <span class="p">(</span><span class="n">Data</span><span class="p">,</span> <span class="n">DataType</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Data</span>



<div class="viewcode-block" id="EdfFile.GetPixel"><a class="viewcode-back" href="../../../../resources/dataexchange.xtomo.formats.EdfFile.html#dataexchange.xtomo.formats.EdfFile.EdfFile.GetPixel">[docs]</a>    <span class="k">def</span> <span class="nf">GetPixel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Index</span><span class="p">,</span> <span class="n">Position</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns double value of the pixel, regardless the format of the array</span>
<span class="sd">            Index:      The zero-based index of the image in the file</span>
<span class="sd">            Position:   Tuple with the coordinete (x), (x,y) or (x,y,z)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">Index</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">Index</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NumImages</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="s">&quot;EdfFile: Index out of limit&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Position</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">NumDim</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="s">&quot;EdfFile: coordinate with wrong dimension &quot;</span>

        <span class="n">size_pixel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__GetSizeNumpyType__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__GetDefaultNumpyType__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">DataType</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">Index</span><span class="p">)</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="n">Position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">size_pixel</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">NumDim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">size_row</span> <span class="o">=</span> <span class="n">size_pixel</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim1</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="n">offset</span> <span class="o">+</span> <span class="p">(</span><span class="n">Position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">size_row</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">NumDim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">size_img</span> <span class="o">=</span> <span class="n">size_row</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim2</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="n">offset</span> <span class="o">+</span> <span class="p">(</span><span class="n">Position</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">size_img</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">DataPosition</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">Data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">size_pixel</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">__GetDefaultNumpyType__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">DataType</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">Index</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">string</span><span class="o">.</span><span class="n">upper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SysByteOrder</span><span class="p">)</span> <span class="o">!=</span> <span class="n">string</span><span class="o">.</span><span class="n">upper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">ByteOrder</span><span class="p">):</span>
            <span class="n">Data</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="n">byteswap</span><span class="p">()</span>
        <span class="n">Data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__SetDataType__</span> <span class="p">(</span><span class="n">Data</span><span class="p">,</span> <span class="s">&quot;DoubleValue&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

</div>
<div class="viewcode-block" id="EdfFile.GetHeader"><a class="viewcode-back" href="../../../../resources/dataexchange.xtomo.formats.EdfFile.html#dataexchange.xtomo.formats.EdfFile.EdfFile.GetHeader">[docs]</a>    <span class="k">def</span> <span class="nf">GetHeader</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns dictionary with image header fields.</span>
<span class="sd">            Does not include the basic fields (static) defined by data shape, </span>
<span class="sd">            type and file position. These are get with GetStaticHeader</span>
<span class="sd">            method.</span>
<span class="sd">            Index:          The zero-based index of the image in the file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">Index</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">Index</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NumImages</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="s">&quot;Index out of limit&quot;</span>
        <span class="c">#return self.Images[Index].Header</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Header</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">ret</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">ret</span>

</div>
<div class="viewcode-block" id="EdfFile.GetStaticHeader"><a class="viewcode-back" href="../../../../resources/dataexchange.xtomo.formats.EdfFile.html#dataexchange.xtomo.formats.EdfFile.EdfFile.GetStaticHeader">[docs]</a>    <span class="k">def</span> <span class="nf">GetStaticHeader</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns dictionary with static parameters</span>
<span class="sd">            Data format and file position dependent information</span>
<span class="sd">            (dim1,dim2,size,datatype,byteorder,headerId,Image)</span>
<span class="sd">            Index:          The zero-based index of the image in the file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">Index</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">Index</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NumImages</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="s">&quot;Index out of limit&quot;</span>
        <span class="c">#return self.Images[Index].StaticHeader</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">StaticHeader</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">ret</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">StaticHeader</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">ret</span>
</div>
<div class="viewcode-block" id="EdfFile.WriteImage"><a class="viewcode-back" href="../../../../resources/dataexchange.xtomo.formats.EdfFile.html#dataexchange.xtomo.formats.EdfFile.EdfFile.WriteImage">[docs]</a>    <span class="k">def</span> <span class="nf">WriteImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">var</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__makeSureFileIsOpen</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_WriteImage</span><span class="p">(</span><span class="o">*</span><span class="n">var</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__makeSureFileIsClosed</span><span class="p">()</span>
    </div>
    <span class="k">def</span> <span class="nf">_WriteImage</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Header</span><span class="p">,</span> <span class="n">Data</span><span class="p">,</span> <span class="n">Append</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">DataType</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">ByteOrder</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Writes image to the file. </span>
<span class="sd">            Header:         Dictionary containing the non-static header</span>
<span class="sd">                            information (static information is generated</span>
<span class="sd">                            according to position of image and data format</span>
<span class="sd">            Append:         If equals to 0, overwrites the file. Otherwise, appends</span>
<span class="sd">                            to the end of the file</span>
<span class="sd">            DataType:       The data type to be saved to the file:</span>
<span class="sd">                                SignedByte          </span>
<span class="sd">                                UnsignedByte               </span>
<span class="sd">                                SignedShort         </span>
<span class="sd">                                UnsignedShort       </span>
<span class="sd">                                SignedInteger       </span>
<span class="sd">                                UnsignedInteger     </span>
<span class="sd">                                SignedLong          </span>
<span class="sd">                                UnsignedLong        </span>
<span class="sd">                                FloatValue          </span>
<span class="sd">                                DoubleValue         </span>
<span class="sd">                            Default: according to Data array typecode:</span>
<span class="sd">                                    1:  SignedByte</span>
<span class="sd">                                    b:  UnsignedByte</span>
<span class="sd">                                    s:  SignedShort       </span>
<span class="sd">				    w:  UnsignedShort</span>
<span class="sd">                                    i:  SignedInteger</span>
<span class="sd">                                    l:  SignedLong          </span>
<span class="sd">				    u:  UnsignedLong</span>
<span class="sd">                                    f:  FloatValue       </span>
<span class="sd">                                    d:  DoubleValue</span>
<span class="sd">            ByteOrder:      Byte order of the data in file:</span>
<span class="sd">                                HighByteFirst</span>
<span class="sd">                                LowByteFirst</span>
<span class="sd">                            Default: system&#39;s byte order</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">Append</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">truncate</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Images</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NumImages</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">Index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NumImages</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NumImages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NumImages</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Image</span><span class="p">())</span>

        <span class="c">#self.Images[Index].StaticHeader[&quot;Dim_1&quot;] = &quot;%d&quot; % Data.shape[1]</span>
        <span class="c">#self.Images[Index].StaticHeader[&quot;Dim_2&quot;] = &quot;%d&quot; % Data.shape[0]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim1</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">StaticHeader</span><span class="p">[</span><span class="s">&quot;Dim_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Size</span> <span class="o">=</span> <span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> \
                                     <span class="bp">self</span><span class="o">.</span><span class="n">__GetSizeNumpyType__</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim1</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim2</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">StaticHeader</span><span class="p">[</span><span class="s">&quot;Dim_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">StaticHeader</span><span class="p">[</span><span class="s">&quot;Dim_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Size</span> <span class="o">=</span> <span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">Data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> \
                                     <span class="bp">self</span><span class="o">.</span><span class="n">__GetSizeNumpyType__</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">NumDim</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim1</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim2</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim3</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">StaticHeader</span><span class="p">[</span><span class="s">&quot;Dim_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">StaticHeader</span><span class="p">[</span><span class="s">&quot;Dim_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">StaticHeader</span><span class="p">[</span><span class="s">&quot;Dim_3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim3</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Size</span> <span class="o">=</span> <span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">Data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">Data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> \
                                     <span class="bp">self</span><span class="o">.</span><span class="n">__GetSizeNumpyType__</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">NumDim</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="s">&quot;EdfFile: Data dimension not suported&quot;</span>


        <span class="k">if</span> <span class="n">DataType</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">DataType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__GetDefaultEdfType__</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">DataType</span> <span class="o">=</span> <span class="n">DataType</span>
            <span class="n">Data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__SetDataType__</span> <span class="p">(</span><span class="n">Data</span><span class="p">,</span> <span class="n">DataType</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ByteOrder</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">ByteOrder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SysByteOrder</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">ByteOrder</span> <span class="o">=</span> <span class="n">ByteOrder</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">StaticHeader</span><span class="p">[</span><span class="s">&quot;Size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">StaticHeader</span><span class="p">[</span><span class="s">&quot;Image&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Index</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">StaticHeader</span><span class="p">[</span><span class="s">&quot;HeaderID&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;EH:</span><span class="si">%06d</span><span class="s">:000000:000000&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">StaticHeader</span><span class="p">[</span><span class="s">&quot;Image&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">StaticHeader</span><span class="p">[</span><span class="s">&quot;ByteOrder&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">ByteOrder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">StaticHeader</span><span class="p">[</span><span class="s">&quot;DataType&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">DataType</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Header</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">StrHeader</span> <span class="o">=</span> <span class="s">&quot;{</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">STATIC_HEADER_ELEMENTS</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">StaticHeader</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">StrHeader</span> <span class="o">=</span> <span class="n">StrHeader</span> <span class="o">+</span> <span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> = </span><span class="si">%s</span><span class="s"> ;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span> <span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">StaticHeader</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">Header</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">StrHeader</span> <span class="o">=</span> <span class="n">StrHeader</span> <span class="o">+</span> <span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> = </span><span class="si">%s</span><span class="s"> ;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">Header</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">Header</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Header</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">newsize</span> <span class="o">=</span> <span class="p">(((</span><span class="nb">len</span><span class="p">(</span><span class="n">StrHeader</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">HEADER_BLOCK_SIZE</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">HEADER_BLOCK_SIZE</span> <span class="o">-</span> <span class="mi">2</span>
        <span class="n">StrHeader</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="n">StrHeader</span><span class="p">,</span> <span class="n">newsize</span><span class="p">)</span>
        <span class="n">StrHeader</span> <span class="o">=</span> <span class="n">StrHeader</span> <span class="o">+</span> <span class="s">&quot;}</span><span class="se">\n</span><span class="s">&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">HeaderPosition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">StrHeader</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">DataPosition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>

        <span class="c">#if self.Images[Index].StaticHeader[&quot;ByteOrder&quot;] != self.SysByteOrder:</span>
        <span class="k">if</span> <span class="n">string</span><span class="o">.</span><span class="n">upper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span><span class="o">.</span><span class="n">ByteOrder</span><span class="p">)</span> <span class="o">!=</span> <span class="n">string</span><span class="o">.</span><span class="n">upper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SysByteOrder</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">write</span><span class="p">((</span><span class="n">Data</span><span class="o">.</span><span class="n">byteswap</span><span class="p">())</span><span class="o">.</span><span class="n">tostring</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">Data</span><span class="o">.</span><span class="n">tostring</span><span class="p">())</span>



    <span class="c">############################################################################</span>
    <span class="c">#Internal Methods</span>

    <span class="k">def</span> <span class="nf">__makeSureFileIsOpen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Making sure file is open&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ADSC</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">MARCCD</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">PILATUS_CBF</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&quot;Special case. Image is buffered&quot;</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">File</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">None</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&quot;File is None&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">closed</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&quot;Reopening closed file&quot;</span>
            <span class="n">accessMode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">mode</span>
            <span class="n">fileName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">name</span>
            <span class="n">newFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="n">accessMode</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">File</span>  <span class="o">=</span> <span class="n">newFile</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">__makeSureFileIsClosed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Making sure file is closed&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ADSC</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">MARCCD</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">PILATUS_CBF</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&quot;Special case. Image is buffered&quot;</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">File</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">None</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&quot;File is None&quot;</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">closed</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&quot;Closing file&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span>

        
    <span class="k">def</span> <span class="nf">__GetDefaultNumpyType__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">EdfType</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Internal method: returns NumPy type according to Edf type</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDefaultNumpyType</span><span class="p">(</span><span class="n">EdfType</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__GetDefaultEdfType__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NumpyType</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Internal method: returns Edf type according Numpy type</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span>   <span class="n">NumpyType</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;b&quot;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int8</span><span class="p">]:</span>            <span class="k">return</span> <span class="s">&quot;SignedByte&quot;</span>
        <span class="k">elif</span> <span class="n">NumpyType</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;B&quot;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">]:</span>            <span class="k">return</span> <span class="s">&quot;UnsignedByte&quot;</span>
        <span class="k">elif</span> <span class="n">NumpyType</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;h&quot;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int16</span><span class="p">]:</span>            <span class="k">return</span> <span class="s">&quot;SignedShort&quot;</span>
        <span class="k">elif</span> <span class="n">NumpyType</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;H&quot;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint16</span><span class="p">]:</span>            <span class="k">return</span> <span class="s">&quot;UnsignedShort&quot;</span>
        <span class="k">elif</span> <span class="n">NumpyType</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;i&quot;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">]:</span>            <span class="k">return</span> <span class="s">&quot;SignedInteger&quot;</span>
        <span class="k">elif</span> <span class="n">NumpyType</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;I&quot;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint32</span><span class="p">]:</span>            <span class="k">return</span> <span class="s">&quot;UnsignedInteger&quot;</span>
        <span class="k">elif</span> <span class="n">NumpyType</span> <span class="o">==</span> <span class="s">&quot;l&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s">&#39;linux2&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">&quot;Signed64&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">&quot;SignedLong&quot;</span>
        <span class="k">elif</span> <span class="n">NumpyType</span> <span class="o">==</span> <span class="s">&quot;L&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s">&#39;linux2&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">&quot;Unsigned64&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">&quot;UnsignedLong&quot;</span>
        <span class="k">elif</span> <span class="n">NumpyType</span> <span class="o">==</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int64</span><span class="p">:</span>                     <span class="k">return</span> <span class="s">&quot;Signed64&quot;</span>
        <span class="k">elif</span> <span class="n">NumpyType</span> <span class="o">==</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint64</span><span class="p">:</span>                    <span class="k">return</span> <span class="s">&quot;Unsigned64&quot;</span>
        <span class="k">elif</span> <span class="n">NumpyType</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;f&quot;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">]:</span>            <span class="k">return</span> <span class="s">&quot;FloatValue&quot;</span>
        <span class="k">elif</span> <span class="n">NumpyType</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;d&quot;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span>            <span class="k">return</span> <span class="s">&quot;DoubleValue&quot;</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="s">&quot;unknown NumpyType </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">NumpyType</span>


    <span class="k">def</span> <span class="nf">__GetSizeNumpyType__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NumpyType</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Internal method: returns size of NumPy&#39;s Array Types</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span>   <span class="n">NumpyType</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;b&quot;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int8</span><span class="p">]:</span>  <span class="k">return</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">NumpyType</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;B&quot;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">]:</span>  <span class="k">return</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">NumpyType</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;h&quot;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int16</span><span class="p">]:</span>  <span class="k">return</span> <span class="mi">2</span>
        <span class="k">elif</span> <span class="n">NumpyType</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;H&quot;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint16</span><span class="p">]:</span>  <span class="k">return</span> <span class="mi">2</span>
        <span class="k">elif</span> <span class="n">NumpyType</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;i&quot;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int32</span><span class="p">]:</span>  <span class="k">return</span> <span class="mi">4</span>
        <span class="k">elif</span> <span class="n">NumpyType</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;I&quot;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint32</span><span class="p">]:</span>  <span class="k">return</span> <span class="mi">4</span>
        <span class="k">elif</span> <span class="n">NumpyType</span> <span class="o">==</span> <span class="s">&quot;l&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s">&#39;linux2&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">8</span>    <span class="c">#64 bit</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">4</span>    <span class="c">#32 bit</span>
        <span class="k">elif</span> <span class="n">NumpyType</span> <span class="o">==</span> <span class="s">&quot;L&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s">&#39;linux2&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">8</span>    <span class="c">#64 bit</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">4</span>    <span class="c">#32 bit</span>
        <span class="k">elif</span> <span class="n">NumpyType</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;f&quot;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">]:</span> <span class="k">return</span> <span class="mi">4</span>
        <span class="k">elif</span> <span class="n">NumpyType</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;d&quot;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">]:</span> <span class="k">return</span> <span class="mi">8</span>
        <span class="k">elif</span> <span class="n">NumpyType</span> <span class="o">==</span> <span class="s">&quot;Q&quot;</span><span class="p">:</span>            <span class="k">return</span> <span class="mi">8</span> <span class="c">#unsigned 64 in 32 bit</span>
        <span class="k">elif</span> <span class="n">NumpyType</span> <span class="o">==</span> <span class="s">&quot;q&quot;</span><span class="p">:</span>            <span class="k">return</span> <span class="mi">8</span> <span class="c">#signed 64 in 32 bit</span>
        <span class="k">elif</span> <span class="n">NumpyType</span> <span class="o">==</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint64</span><span class="p">:</span>   <span class="k">return</span> <span class="mi">8</span>
        <span class="k">elif</span> <span class="n">NumpyType</span> <span class="o">==</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int64</span><span class="p">:</span>    <span class="k">return</span> <span class="mi">8</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="s">&quot;unknown NumpyType </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">NumpyType</span>


    <span class="k">def</span> <span class="nf">__SetDataType__</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Array</span><span class="p">,</span> <span class="n">DataType</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Internal method: array type convertion</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># AVOID problems not using FromEdfType= Array.dtype.char</span>
        <span class="n">FromEdfType</span> <span class="o">=</span> <span class="n">Array</span><span class="o">.</span><span class="n">dtype</span>
        <span class="n">ToEdfType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__GetDefaultNumpyType__</span><span class="p">(</span><span class="n">DataType</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ToEdfType</span> <span class="o">!=</span> <span class="n">FromEdfType</span><span class="p">:</span>
            <span class="n">aux</span> <span class="o">=</span> <span class="n">Array</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__GetDefaultNumpyType__</span><span class="p">(</span><span class="n">DataType</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">aux</span>
        <span class="k">return</span> <span class="n">Array</span>

    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__makeSureFileIsClosed</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

<div class="viewcode-block" id="EdfFile.GetDefaultNumpyType"><a class="viewcode-back" href="../../../../resources/dataexchange.xtomo.formats.EdfFile.html#dataexchange.xtomo.formats.EdfFile.EdfFile.GetDefaultNumpyType">[docs]</a>    <span class="k">def</span> <span class="nf">GetDefaultNumpyType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">EdfType</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns NumPy type according Edf type</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span><span class="k">return</span> <span class="n">GetDefaultNumpyType</span><span class="p">(</span><span class="n">EdfType</span><span class="p">)</span>
        <span class="n">EdfType</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">upper</span><span class="p">(</span><span class="n">EdfType</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">EdfType</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;SIGNED64&#39;</span><span class="p">]</span>  <span class="p">:</span><span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int64</span>
        <span class="k">if</span> <span class="n">EdfType</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;UNSIGNED64&#39;</span><span class="p">]:</span><span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint64</span>
        <span class="k">if</span> <span class="n">EdfType</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;SIGNEDLONG&quot;</span><span class="p">,</span> <span class="s">&quot;UNSIGNEDLONG&quot;</span><span class="p">]:</span>
            <span class="n">dim1</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">dim2</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">dim3</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="s">&quot;Dim1&quot;</span><span class="p">):</span>
                <span class="n">dim1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim1</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="s">&quot;Dim2&quot;</span><span class="p">):</span>
                    <span class="n">dim2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim2</span>
                    <span class="k">if</span> <span class="n">dim2</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span> <span class="n">dim2</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="s">&quot;Dim3&quot;</span><span class="p">):</span>
                        <span class="n">dim3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">Dim3</span>
                        <span class="k">if</span> <span class="n">dim3</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span> <span class="n">dim3</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="s">&quot;Size&quot;</span><span class="p">):</span>
                    <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Images</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">Size</span>
                    <span class="k">if</span> <span class="n">size</span> <span class="o">/</span> <span class="p">(</span><span class="n">dim1</span> <span class="o">*</span> <span class="n">dim2</span> <span class="o">*</span> <span class="n">dim3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">EdfType</span> <span class="o">==</span> <span class="s">&quot;UNSIGNEDLONG&quot;</span><span class="p">:</span>
                            <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint64</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int64</span>
            <span class="k">if</span> <span class="n">EdfType</span> <span class="o">==</span> <span class="s">&quot;UNSIGNEDLONG&quot;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint32</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int32</span>

        <span class="k">return</span> <span class="n">GetDefaultNumpyType</span><span class="p">(</span><span class="n">EdfType</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="GetDefaultNumpyType"><a class="viewcode-back" href="../../../../resources/dataexchange.xtomo.formats.EdfFile.html#dataexchange.xtomo.formats.EdfFile.GetDefaultNumpyType">[docs]</a><span class="k">def</span> <span class="nf">GetDefaultNumpyType</span><span class="p">(</span><span class="n">EdfType</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns NumPy type according Edf type</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">EdfType</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">upper</span><span class="p">(</span><span class="n">EdfType</span><span class="p">)</span>
    <span class="k">if</span>   <span class="n">EdfType</span> <span class="o">==</span> <span class="s">&quot;SIGNEDBYTE&quot;</span><span class="p">:</span>       <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int8</span>   <span class="c"># &quot;b&quot;</span>
    <span class="k">elif</span> <span class="n">EdfType</span> <span class="o">==</span> <span class="s">&quot;UNSIGNEDBYTE&quot;</span><span class="p">:</span>     <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span>  <span class="c"># &quot;B&quot;       </span>
    <span class="k">elif</span> <span class="n">EdfType</span> <span class="o">==</span> <span class="s">&quot;SIGNEDSHORT&quot;</span><span class="p">:</span>      <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int16</span>  <span class="c"># &quot;h&quot;</span>
    <span class="k">elif</span> <span class="n">EdfType</span> <span class="o">==</span> <span class="s">&quot;UNSIGNEDSHORT&quot;</span><span class="p">:</span>    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint16</span> <span class="c"># &quot;H&quot;</span>
    <span class="k">elif</span> <span class="n">EdfType</span> <span class="o">==</span> <span class="s">&quot;SIGNEDINTEGER&quot;</span><span class="p">:</span>    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int32</span>  <span class="c"># &quot;i&quot;</span>
    <span class="k">elif</span> <span class="n">EdfType</span> <span class="o">==</span> <span class="s">&quot;UNSIGNEDINTEGER&quot;</span><span class="p">:</span>  <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint32</span> <span class="c"># &quot;I&quot;</span>
    <span class="k">elif</span> <span class="n">EdfType</span> <span class="o">==</span> <span class="s">&quot;SIGNEDLONG&quot;</span><span class="p">:</span>       <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int32</span>  <span class="c"># &quot;i&quot; #ESRF acquisition is made in 32bit</span>
    <span class="k">elif</span> <span class="n">EdfType</span> <span class="o">==</span> <span class="s">&quot;UNSIGNEDLONG&quot;</span><span class="p">:</span>     <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint32</span> <span class="c"># &quot;I&quot; #ESRF acquisition is made in 32bit</span>
    <span class="k">elif</span> <span class="n">EdfType</span> <span class="o">==</span> <span class="s">&quot;SIGNED64&quot;</span><span class="p">:</span>         <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">int64</span>  <span class="c"># &quot;l&quot;</span>
    <span class="k">elif</span> <span class="n">EdfType</span> <span class="o">==</span> <span class="s">&quot;UNSIGNED64&quot;</span><span class="p">:</span>       <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint64</span> <span class="c"># &quot;L&quot;</span>
    <span class="k">elif</span> <span class="n">EdfType</span> <span class="o">==</span> <span class="s">&quot;FLOATVALUE&quot;</span><span class="p">:</span>       <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">float32</span> <span class="c"># &quot;f&quot;</span>
    <span class="k">elif</span> <span class="n">EdfType</span> <span class="o">==</span> <span class="s">&quot;FLOAT&quot;</span><span class="p">:</span>            <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">float32</span> <span class="c"># &quot;f&quot;</span>
    <span class="k">elif</span> <span class="n">EdfType</span> <span class="o">==</span> <span class="s">&quot;DOUBLEVALUE&quot;</span><span class="p">:</span>      <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">float64</span> <span class="c"># &quot;d&quot;</span>
    <span class="k">else</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="s">&quot;unknown EdfType </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">EdfType</span>

</div>
<div class="viewcode-block" id="SetDictCase"><a class="viewcode-back" href="../../../../resources/dataexchange.xtomo.formats.EdfFile.html#dataexchange.xtomo.formats.EdfFile.SetDictCase">[docs]</a><span class="k">def</span> <span class="nf">SetDictCase</span><span class="p">(</span><span class="n">Dict</span><span class="p">,</span> <span class="n">Case</span><span class="p">,</span> <span class="n">Flag</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns dictionary with keys and/or values converted into upper or lowercase</span>
<span class="sd">        Dict:   input dictionary</span>
<span class="sd">        Case:   LOWER_CASE, UPPER_CASE</span>
<span class="sd">        Flag:   KEYS, VALUES or KEYS | VALUES        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">newdict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">Dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">newkey</span> <span class="o">=</span> <span class="n">i</span>
        <span class="n">newvalue</span> <span class="o">=</span> <span class="n">Dict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">Flag</span> <span class="o">&amp;</span> <span class="n">KEYS</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">Case</span> <span class="o">==</span> <span class="n">LOWER_CASE</span><span class="p">:</span>  <span class="n">newkey</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">lower</span><span class="p">(</span><span class="n">newkey</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>                   <span class="n">newkey</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">upper</span><span class="p">(</span><span class="n">newkey</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Flag</span> <span class="o">&amp;</span> <span class="n">VALUES</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">Case</span> <span class="o">==</span> <span class="n">LOWER_CASE</span><span class="p">:</span>  <span class="n">newvalue</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">lower</span><span class="p">(</span><span class="n">newvalue</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>                   <span class="n">newvalue</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">upper</span><span class="p">(</span><span class="n">newvalue</span><span class="p">)</span>
        <span class="n">newdict</span><span class="p">[</span><span class="n">newkey</span><span class="p">]</span> <span class="o">=</span> <span class="n">newvalue</span>
    <span class="k">return</span> <span class="n">newdict</span>

</div>
<div class="viewcode-block" id="GetRegion"><a class="viewcode-back" href="../../../../resources/dataexchange.xtomo.formats.EdfFile.html#dataexchange.xtomo.formats.EdfFile.GetRegion">[docs]</a><span class="k">def</span> <span class="nf">GetRegion</span><span class="p">(</span><span class="n">Arr</span><span class="p">,</span> <span class="n">Pos</span><span class="p">,</span> <span class="n">Size</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns array with refion of Arr.</span>
<span class="sd">       Arr must be 1d, 2d or 3d</span>
<span class="sd">       Pos and Size are tuples in the format (x) or (x,y) or (x,y,z)</span>
<span class="sd">       Both parameters must have the same size as the dimention of Arr</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Dim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Pos</span><span class="p">)</span> <span class="o">!=</span> <span class="n">Dim</span><span class="p">:</span>  <span class="k">return</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Size</span><span class="p">)</span> <span class="o">!=</span> <span class="n">Dim</span><span class="p">:</span> <span class="k">return</span> <span class="bp">None</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">Dim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">SizeX</span> <span class="o">=</span> <span class="n">Size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">SizeX</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">SizeX</span> <span class="o">=</span> <span class="n">Arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">Pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ArrRet</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">Arr</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">Pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">SizeX</span><span class="p">))</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">Dim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">SizeX</span> <span class="o">=</span> <span class="n">Size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">SizeY</span> <span class="o">=</span> <span class="n">Size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">SizeX</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">SizeX</span> <span class="o">=</span> <span class="n">Arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">Pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">SizeY</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">SizeY</span> <span class="o">=</span> <span class="n">Arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">Pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ArrRet</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">Arr</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">Pos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">SizeY</span><span class="p">))</span>
        <span class="n">ArrRet</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">ArrRet</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">Pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">SizeX</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">Dim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">):</span>
        <span class="n">SizeX</span> <span class="o">=</span> <span class="n">Size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">SizeY</span> <span class="o">=</span> <span class="n">Size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">SizeZ</span> <span class="o">=</span> <span class="n">Size</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">SizeX</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">SizeX</span> <span class="o">=</span> <span class="n">Arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">Pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">SizeY</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">SizeX</span> <span class="o">=</span> <span class="n">Arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">Pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">SizeZ</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">SizeZ</span> <span class="o">=</span> <span class="n">Arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">Pos</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">ArrRet</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">Arr</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">Pos</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">Pos</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">SizeZ</span><span class="p">))</span>
        <span class="n">ArrRet</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">ArrRet</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">Pos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">SizeY</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">ArrRet</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">ArrRet</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">Pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">SizeX</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ArrRet</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">return</span> <span class="n">ArrRet</span>

<span class="c">#EXEMPLE CODE:        </span></div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">if</span> <span class="mi">1</span><span class="p">:</span>
<span class="c">#        import os</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
                <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span>
        <span class="n">edf</span> <span class="o">=</span> <span class="n">EdfFile</span><span class="p">(</span><span class="s">&quot;armando.edf&quot;</span><span class="p">)</span>
        <span class="n">edf</span><span class="o">.</span><span class="n">WriteImage</span><span class="p">({},</span> <span class="n">a</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">edf</span> <span class="c">#force to close the file</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="n">EdfFile</span><span class="p">(</span><span class="s">&quot;armando.edf&quot;</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">inp</span><span class="o">.</span><span class="n">GetData</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">EdfFile</span><span class="p">(</span><span class="s">&quot;armando2.edf&quot;</span><span class="p">)</span>
        <span class="n">out</span><span class="o">.</span><span class="n">WriteImage</span><span class="p">({},</span> <span class="n">b</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">out</span> <span class="c">#force to close the file</span>
        <span class="n">inp2</span> <span class="o">=</span> <span class="n">EdfFile</span><span class="p">(</span><span class="s">&quot;armando2.edf&quot;</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">inp2</span><span class="o">.</span><span class="n">GetData</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&quot;A SHAPE = &quot;</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">print</span> <span class="s">&quot;B SHAPE = &quot;</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">print</span> <span class="s">&quot;C SHAPE = &quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
            <span class="k">print</span> <span class="s">&quot;A&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
            <span class="k">print</span> <span class="s">&quot;B&quot;</span><span class="p">,</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
            <span class="k">print</span> <span class="s">&quot;C&quot;</span><span class="p">,</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">x</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">20</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;SignedByte&quot;</span><span class="p">,</span> <span class="s">&quot;UnsignedByte&quot;</span><span class="p">,</span>
                     <span class="s">&quot;SignedShort&quot;</span><span class="p">,</span> <span class="s">&quot;UnsignedShort&quot;</span><span class="p">,</span>
                     <span class="s">&quot;SignedLong&quot;</span><span class="p">,</span> <span class="s">&quot;UnsignedLong&quot;</span><span class="p">,</span>
                     <span class="s">&quot;Signed64&quot;</span><span class="p">,</span> <span class="s">&quot;Unsigned64&quot;</span><span class="p">,</span>
                     <span class="s">&quot;FloatValue&quot;</span><span class="p">,</span> <span class="s">&quot;DoubleValue&quot;</span><span class="p">]:</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="n">item</span> <span class="o">+</span> <span class="s">&quot;.edf&quot;</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
            <span class="n">towrite</span> <span class="o">=</span> <span class="n">EdfFile</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
            <span class="n">towrite</span><span class="o">.</span><span class="n">WriteImage</span><span class="p">({},</span> <span class="n">x</span><span class="p">,</span> <span class="n">DataType</span><span class="o">=</span><span class="n">item</span><span class="p">,</span> <span class="n">Append</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="c">#Creates object based on file exe.edf</span>
    <span class="n">exe</span> <span class="o">=</span> <span class="n">EdfFile</span><span class="p">(</span><span class="s">&quot;images/test_image.edf&quot;</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">EdfFile</span><span class="p">(</span><span class="s">&quot;images/test_getdata.edf&quot;</span><span class="p">)</span>
    <span class="c">#Gets unsigned short data, storing in an signed long</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">exe</span><span class="o">.</span><span class="n">GetData</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Pos</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span> <span class="n">Size</span><span class="o">=</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">400</span><span class="p">))</span>
    <span class="n">x</span><span class="o">.</span><span class="n">WriteImage</span><span class="p">({},</span> <span class="n">arr</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">arr</span> <span class="o">=</span> <span class="n">exe</span><span class="o">.</span><span class="n">GetData</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Pos</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">))</span>
    <span class="n">x</span><span class="o">.</span><span class="n">WriteImage</span><span class="p">({},</span> <span class="n">arr</span><span class="p">)</span>

    <span class="n">arr</span> <span class="o">=</span> <span class="n">exe</span><span class="o">.</span><span class="n">GetData</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Size</span><span class="o">=</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">400</span><span class="p">))</span>
    <span class="n">x</span><span class="o">.</span><span class="n">WriteImage</span><span class="p">({},</span> <span class="n">arr</span><span class="p">)</span>

    <span class="n">arr</span> <span class="o">=</span> <span class="n">exe</span><span class="o">.</span><span class="n">GetData</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">x</span><span class="o">.</span><span class="n">WriteImage</span><span class="p">({},</span> <span class="n">arr</span><span class="p">)</span>

    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

    <span class="c">#Creates object based on file exe.edf</span>
    <span class="n">exe</span> <span class="o">=</span> <span class="n">EdfFile</span><span class="p">(</span><span class="s">&quot;images/.edf&quot;</span><span class="p">)</span>

    <span class="c">#Creates long array , filled with 0xFFFFFFFF(-1)</span>
    <span class="n">la</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
    <span class="n">la</span> <span class="o">=</span> <span class="n">la</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="c">#Creates a short array, filled with 0xFFFF</span>
    <span class="n">sa</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
    <span class="n">sa</span> <span class="o">=</span> <span class="n">sa</span> <span class="o">+</span> <span class="mh">0xFFFF</span>
    <span class="n">sa</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">&quot;s&quot;</span><span class="p">)</span>

    <span class="c">#Writes long array, initializing file (append=0)</span>
    <span class="n">exe</span><span class="o">.</span><span class="n">WriteImage</span><span class="p">({},</span> <span class="n">la</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>

    <span class="c">#Appends short array with new header items</span>
    <span class="n">exe</span><span class="o">.</span><span class="n">WriteImage</span><span class="p">({</span><span class="s">&#39;Name&#39;</span><span class="p">:</span> <span class="s">&#39;Alexandre&#39;</span><span class="p">,</span> <span class="s">&#39;Date&#39;</span><span class="p">:</span> <span class="s">&#39;16/07/2001&#39;</span><span class="p">},</span> <span class="n">sa</span><span class="p">)</span>

    <span class="c">#Appends short array, in Edf type unsigned</span>
    <span class="n">exe</span><span class="o">.</span><span class="n">WriteImage</span><span class="p">({},</span> <span class="n">sa</span><span class="p">,</span> <span class="n">DataType</span><span class="o">=</span><span class="s">&quot;UnsignedShort&quot;</span><span class="p">)</span>

    <span class="c">#Appends short array, in Edf type unsigned</span>
    <span class="n">exe</span><span class="o">.</span><span class="n">WriteImage</span><span class="p">({},</span> <span class="n">sa</span><span class="p">,</span> <span class="n">DataType</span><span class="o">=</span><span class="s">&quot;UnsignedLong&quot;</span><span class="p">)</span>

    <span class="c">#Appends long array as a double, considering unsigned</span>
    <span class="n">exe</span><span class="o">.</span><span class="n">WriteImage</span><span class="p">({},</span> <span class="n">la</span><span class="p">,</span> <span class="n">DataType</span><span class="o">=</span><span class="s">&quot;DoubleValue&quot;</span><span class="p">,</span> <span class="n">WriteAsUnsigened</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c">#Gets unsigned short data, storing in an signed long</span>
    <span class="n">ushort</span> <span class="o">=</span> <span class="n">exe</span><span class="o">.</span><span class="n">GetData</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">&quot;SignedLong&quot;</span><span class="p">)</span>

    <span class="c">#Makes an operation</span>
    <span class="n">ushort</span> <span class="o">=</span> <span class="n">ushort</span> <span class="o">-</span> <span class="mh">0x10</span>

    <span class="c">#Saves Result as signed long</span>
    <span class="n">exe</span><span class="o">.</span><span class="n">WriteImage</span><span class="p">({},</span> <span class="n">ushort</span><span class="p">)</span>

    <span class="c">#Saves in the original format (unsigned short)</span>
    <span class="n">OldHeader</span> <span class="o">=</span> <span class="n">exe</span><span class="o">.</span><span class="n">GetStaticHeader</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">exe</span><span class="o">.</span><span class="n">WriteImage</span><span class="p">({},</span> <span class="n">ushort</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">OldHeader</span><span class="p">[</span><span class="s">&quot;DataType&quot;</span><span class="p">])</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../../index.html">Data Exchange 0.2 documentation</a> &raquo;</li>
          <li><a href="../../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Argonne National Laboratory.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>